# Plan A â€” Cursor Rules (Lornu AI)

## Scope
This repo follows **Plan A (Minimum Viable Infrastructure)**:
- **Single EKS cluster** with **multi-namespace isolation**.
- **Kustomize overlays** per environment: `lornu-dev`, `lornu-staging`, `lornu-prod`.
- **Modern runtimes**: Bun (frontend) and uv (backend).

## Directory Structure (DRY)
```
apps/web/              # React frontend (Bun)
packages/api/          # Python backend (uv)
terraform/             # Infrastructure (Terraform Cloud)
kubernetes/base/       # Source of truth manifests
kubernetes/overlays/   # Environment overlays: dev/, staging/, prod/
```

## Kubernetes Standards
- Always use **Kustomize**. Add shared resources to `kubernetes/base/` and patch per env in `kubernetes/overlays/`.
- Namespaces:
  - `lornu-dev`
  - `lornu-staging`
  - `lornu-prod`
- **Protective Metadata** (required on every resource):
  - `lornu.ai/environment`: `development` | `staging` | `production`
  - `lornu.ai/managed-by`: `terraform-cloud`
  - `lornu.ai/asset-id`: `lornu-ai-final-clear-bg`
- Use `lornu-` prefix for resource names.

## Runtime Standards
- **Frontend**: Bun only (`bun install`, `bun run`, `bunx`).
- **Backend**: uv only (`uv sync`, `uv run`).
- Do **not** use npm/yarn/pip.

## Commands
```bash
# Build and apply an overlay
kustomize build kubernetes/overlays/dev | kubectl apply -f -
kubectl apply -k kubernetes/overlays/dev

# Frontend
cd apps/web
bun install
bun run dev

# Backend
cd packages/api
uv sync
uv run python -m packages.api.main
```

## PR Labeling (Required)
- Apply a label for the **worker/agent** (e.g., `codex`, `vs-code-with-github-copilot`, `antigravity`, `claude`) to every PR. If the label doesn't exist, create it first.
- Example commands: `gh label create <agent-name>` (if needed), `gh pr edit <pr-number> --add-label <agent-name>`.
## PR Base Branch (Required)
- Always open PRs against `develop`. For kustomize docs updates, use base `kustomize-develop`.

## Terraform Hygiene (Required)
- Before pushing, run `terraform fmt` and `terraform validate` for any Terraform changes.

## Branding
- Brand asset: `apps/web/src/assets/brand/lornu-ai-final-clear-bg.png`

## Do Not Reference
- AWS ECS or Cloudflare Workers (deprecated for Plan A).
- Helm charts, templates, or values files (Helm is deprecated).
