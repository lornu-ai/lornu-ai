apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
- ../../base

namespace: lornu-prod

commonLabels:
  lornu.ai/environment: production
  lornu.ai/managed-by: kustomize
  lornu.ai/asset-id: lornu-ai-final-clear-bg

replicas:
- name: lornu-ai
  count: 3

images:
- name: lornu-ai
  newName: 702555543026.dkr.ecr.us-east-2.amazonaws.com/lornu-ai-production
  newTag: v1.0.0

patches:
- target:
    kind: Deployment
    name: lornu-ai
  patch: |-
    - op: add
      path: /spec/template/spec/containers/0/env
      value:
      - name: ENVIRONMENT
        value: production

helmCharts:
- name: aws-load-balancer-controller
  repo: https://aws.github.io/eks-charts
  version: 1.6.2
  releaseName: aws-load-balancer-controller
  namespace: kube-system
  valuesInline:
    clusterName: lornu-ai-production-cluster
    serviceAccount:
      create: true
      name: aws-load-balancer-controller
      annotations:
        eks.amazonaws.com/role-arn: arn:aws:iam::702555543026:role/lornu-ai-production-alb-controller

- name: external-secrets
  repo: https://charts.external-secrets.io
  version: 0.9.9
  releaseName: external-secrets
  namespace: external-secrets
  valuesInline:
    installCRDs: true
    serviceAccount:
      create: true
      name: external-secrets
      annotations:
        eks.amazonaws.com/role-arn: arn:aws:iam::702555543026:role/lornu-ai-production-external-secrets
